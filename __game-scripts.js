var Rotation=pc.createScript("rotation");Rotation.attributes.add("torque",{type:"number",default:1}),Rotation.attributes.add("speed",{type:"number",default:.1}),Rotation.attributes.add("direction",{type:"string",default:"right"}),Rotation.attributes.add("PlanetEntity",{type:"entity",title:"Planet Entity"}),Rotation.prototype.update=function(t){this.entity.rigidbody?this.entity.rigidbody.applyTorque(0,this.torque,0):this.entity.getLocalEulerAngles().y<-40?"right"===this.direction?this.entity.rotateLocal(0,50*this.speed,0):this.entity.rotateLocal(0,50*-this.speed,0):"right"===this.direction?this.entity.rotateLocal(0,this.speed,0):this.entity.rotateLocal(0,-this.speed,0)};var OrbitRotation=pc.createScript("orbitRotation");OrbitRotation.attributes.add("Enabled",{type:"boolean",default:!0}),OrbitRotation.attributes.add("Target",{type:"entity",default:null}),OrbitRotation.attributes.add("Radius",{type:"number",default:5}),OrbitRotation.attributes.add("Angle",{type:"number",default:0}),OrbitRotation.attributes.add("MovedSpeed",{type:"number",default:1}),OrbitRotation.attributes.add("SmoothFactor",{type:"number",default:1}),OrbitRotation.attributes.add("CircleSpeed",{type:"number",default:1}),OrbitRotation.attributes.add("Offset",{type:"vec2",default:[0,0]}),OrbitRotation.prototype.initialize=function(){this.mode="soft",null!==this.target&&""!==this.target||alert("Initial Target not set - cannot circle around nothing"),0!==this.angle&&(this.angle*=Math.PI/180)},OrbitRotation.prototype.calcPos=function(){var t=pc.Vec3(0,0,0),i=this.radius*Math.cos(this.angle)*(this.offset.x+1),e=this.radius*Math.sin(this.angle)*(this.offset.y+1);return(t=new pc.Vec3(i,e,0)).add(this.target.getPosition()),t},OrbitRotation.prototype.fixedUpdate=function(t){if(0!==app.timeScale&&!this.undocked&&this.enabled){this.angle+=this.circleSpeed*Math.PI/180;var i=this.calcPos(),e=this.entity.getPosition();this.entity.getRotation();switch(this.mode){case"hard":this.entity.setPosition(i.x,i.y,i.z);break;case"soft":e.lerp(this.entity.getPosition(),i,this.smoothFactor*t),this.entity.setPosition(e.x,e.y,e.z),this.controlRotation&&this.entity.setEulerAngles(this.circleSpeed>0?0:180,this.circleSpeed>0?0:180,180*this.angle/Math.PI-15);break;case"constant":var a=i.clone();a.sub(e),a.normalize(),e.add(a),this.entity.setPosition(e.x,e.y,e.z)}}};var OrbitMove=pc.createScript("orbitMove");OrbitMove.prototype.initialize=function(){},OrbitMove.prototype.update=function(t){};var Line=pc.createScript("line");Line.attributes.add("Radius",{type:"number",default:1}),Line.prototype.update=function(e){var t=new pc.Vec4,r=pc.Color.WHITE,n=this.Radius;this.renderArc(t,n,200,r)},Line.prototype.renderArc=function(e,t,r,n){var a,i=[],c=[],p=2*Math.PI/r,s=0;for(a=0;a<r;a++){var o=Math.sin(s),h=Math.cos(s);s+=p;var u=Math.sin(s),d=Math.cos(s);i.push(new pc.Vec3(e.x+t*o,e.y,e.z+t*h),new pc.Vec3(e.x+t*u,e.y,e.z+t*d)),c.push(n,n)}this.app.renderLines(i,c)};var PlayerController=pc.createScript("playerController");PlayerController.attributes.add("StartPosition",{type:"vec3",default:[0,0,0]}),PlayerController.attributes.add("EndPosition",{type:"vec3",default:[5,0,0]}),PlayerController.attributes.add("FollowEntity",{type:"entity"}),PlayerController.prototype.update=function(t){var e=pc.Color.RED;this.app.renderLine(this.StartPosition,this.FollowEntity.getPosition(),e)};var Projectile=pc.createScript("projectile");Projectile.attributes.add("FireBallEntity",{type:"entity"}),Projectile.attributes.add("CameraEntity",{type:"entity",title:"Camera Entity"}),Projectile.attributes.add("ProjectileEntity",{type:"entity"}),Projectile.attributes.add("OrbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),Projectile.attributes.add("StartPosition",{type:"vec3",default:[0,0,0]}),Projectile.attributes.add("EndPosition",{type:"vec3",default:[5,0,0]}),Projectile.attributes.add("EndPointEntity",{type:"entity"}),Projectile.attributes.add("Sun",{type:"entity",title:"Sun Entity"}),Projectile.attributes.add("radius",{type:"number",title:"BoundingRadius"});var showPrjectile=!1;Projectile.prototype.initialize=function(){this.ray=new pc.Ray,this.hitPosition=new pc.Vec3,this.boundingSphere=new pc.BoundingSphere(this.Sun.getPosition(),this.radius),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.lastTouchPoint=new pc.Vec2,this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this))},Projectile.horizontalQuat=new pc.Quat,Projectile.verticalQuat=new pc.Quat,Projectile.resultQuat=new pc.Quat,Projectile.prototype.rotate=function(t,i){this.entity.getLocalEulerAngles().y<85&&this.entity.getLocalEulerAngles().y>-55?this.entity.rotateLocal(0,-i,0):this.entity.getLocalEulerAngles().y>=85?this.entity.setEulerAngles(0,84.9,0):this.entity.getLocalEulerAngles().y<=-55&&this.entity.setEulerAngles(0,-54.9,0)},Projectile.prototype.doRayCast=function(t){this.CameraEntity.camera.screenToWorld(t.x,t.y,this.CameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.CameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),this.boundingSphere.intersectsRay(this.ray,this.hitPosition)&&console.log("From Projectile")},Projectile.prototype.onTouchStart=function(t){var i=t.touches[0];this.CameraEntity.camera.screenToWorld(i.x,i.y,this.CameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.CameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),this.boundingSphere.intersectsRay(this.ray,this.hitPosition)&&(this.lastTouchPoint.set(i.x,i.y),this.ProjectileEntity.enabled=!0,showPrjectile=!0)},Projectile.prototype.onTouchMove=function(t){var i=t.touches[0],e=i.x-this.lastTouchPoint.x,o=i.y-this.lastTouchPoint.y;this.CameraEntity.camera.screenToWorld(i.x,i.y,this.CameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.CameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),this.boundingSphere.intersectsRay(this.ray,this.hitPosition)&&(this.rotate(e,o),this.lastTouchPoint.set(i.x,i.y))},Projectile.prototype.onTouchEnd=function(t){if(this.CameraEntity.camera.screenToWorld(this.lastTouchPoint.x,this.lastTouchPoint.y,this.CameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.CameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),this.boundingSphere.intersectsRay(this.ray,this.hitPosition)&&showPrjectile){this.ProjectileEntity.enabled=!1,showPrjectile=!1;var i=this.FireBallEntity.clone();i.enabled=!0,this.entity.parent.addChild(i)}else this.ProjectileEntity.enabled=!1,showPrjectile=!1},Projectile.prototype.onMouseDown=function(t){this.CameraEntity.camera.screenToWorld(t.x,t.y,this.CameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.CameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),this.boundingSphere.intersectsRay(this.ray,this.hitPosition)&&(this.ProjectileEntity.enabled=!0,showPrjectile=!0)},Projectile.prototype.onMouseMove=function(t){this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&(this.CameraEntity.camera.screenToWorld(t.x,t.y,this.CameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.CameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),this.boundingSphere.intersectsRay(this.ray,this.hitPosition)&&this.rotate(t.dx,t.dy))},Projectile.prototype.onMouseUp=function(t){if(this.CameraEntity.camera.screenToWorld(t.x,t.y,this.CameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.CameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize(),this.boundingSphere.intersectsRay(this.ray,this.hitPosition)){this.ProjectileEntity.enabled=!1,showPrjectile=!1;var i=this.FireBallEntity.clone();i.enabled=!0,this.entity.parent.addChild(i)}else this.ProjectileEntity.enabled=!1,showPrjectile=!1},Projectile.prototype.update=function(t){if(showPrjectile){var i=pc.Color.RED;this.app.renderLine(this.StartPosition,this.EndPointEntity.getPosition(),i)}},Projectile.prototype.check=function(){console.log("Other Method Called")};var FireBall=pc.createScript("fireBall");FireBall.attributes.add("TargetEntity",{type:"entity"}),FireBall.attributes.add("StartPosition",{type:"vec3",default:[0,0,0]}),FireBall.attributes.add("EndPosition",{type:"vec3",default:[5,0,0]});var ischeck=!1;FireBall.prototype.initialize=function(){this.StartPosition=this.entity.getPosition(),this.EndPosition=this.TargetEntity.getPosition(),this.val=0},FireBall.prototype.update=function(t){if(!(this.val>1)){this.val+=t;var i=new pc.Vec3;i.lerp(this.StartPosition,this.EndPosition,this.val),this.entity.setPosition(i),setTimeout(function(){this.entity.destroy()}.bind(this),900)}};var PlanetHandler=pc.createScript("planetHandler");PlanetHandler.attributes.add("Radius",{type:"number",default:1}),PlanetHandler.attributes.add("Selected",{type:"boolean",default:!1}),PlanetHandler.attributes.add("wrongIndication",{type:"boolean",default:!1}),PlanetHandler.attributes.add("SpeedTextEntity",{type:"entity"}),PlanetHandler.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},PlanetHandler.prototype.onTriggerEnter=function(t){this.Selected?(t.destroy(),this.Selected=!1,this.SpeedTextEntity.enabled=!0,setTimeout(function(){this.SpeedTextEntity.enabled=!1,this.Selected=!0}.bind(this),4e3)):t.script.fireBall.EndPosition=new pc.Vec3(0,0,0)},PlanetHandler.prototype.update=function(t){var e=pc.Color.GREEN,n=this.entity.getPosition(),i=this.Radius;this.Selected?this.renderArc(n,i,200,e):this.wrongIndication&&(e=pc.Color.RED,this.renderArc(n,i,200,e),setTimeout(function(){this.wrongIndication=!1}.bind(this),2e3))},PlanetHandler.prototype.renderArc=function(t,e,n,i){var a,r=[],d=[],o=2*Math.PI/n,l=0;for(a=0;a<n;a++){var s=Math.sin(l),c=Math.cos(l);l+=o;var p=Math.sin(l),h=Math.cos(l);r.push(new pc.Vec3(t.x+e*s,t.y,t.z+e*c),new pc.Vec3(t.x+e*p,t.y,t.z+e*h)),d.push(i,i)}this.app.renderLines(r,d)};var Text=pc.createScript("text");Text.attributes.add("text",{type:"string",default:"Hello World"}),Text.prototype.initialize=function(){this.canvas=document.createElement("canvas"),this.canvas.height=128,this.canvas.width=512,this.context=this.canvas.getContext("2d"),this.texture=new pc.Texture(this.app.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,autoMipmap:!0}),this.texture.setSource(this.canvas),this.texture.minFilter=pc.FILTER_LINEAR_MIPMAP_LINEAR,this.texture.magFilter=pc.FILTER_LINEAR,this.texture.addressU=pc.ADDRESS_CLAMP_TO_EDGE,this.texture.addressV=pc.ADDRESS_CLAMP_TO_EDGE,this.updateText();var t=this.entity.model.material;t.emissiveMap=this.texture,t.opacityMap=this.texture,t.blendType=pc.BLEND_NORMAL,t.update(),this.on("attr",(function(t,e,i){this.updateText()}))},Text.prototype.updateText=function(){var t=this.context,e=t.canvas.width,i=t.canvas.height;t.fillStyle="black",t.fillRect(0,0,e,i),t.fillStyle="white",t.font="bold 70px Verdana",t.textAlign="center",t.textBaseline="middle",t.fillText(this.text,e/2,i/2),this.texture.upload()};var Billboard=pc.createScript("billboard");Billboard.prototype.initialize=function(){this.camera=this.app.root.findByName("Camera")},Billboard.prototype.update=function(t){this.entity.setRotation(this.camera.getRotation()),this.entity.rotateLocal(90,0,0)};var Follow=pc.createScript("follow");Follow.attributes.add("FollowingEntity",{type:"entity"}),Follow.prototype.initialize=function(){},Follow.prototype.update=function(t){this.entity.setPosition(this.FollowingEntity.getPosition())};